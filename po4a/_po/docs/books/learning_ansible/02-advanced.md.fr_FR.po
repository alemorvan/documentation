# French translations for po package
# Traductions françaises du paquet po
# Copyright (C) 2023 Free Software Foundation, Inc.
# This file is distributed under the same license as the po package.
# Automatically generated, 2023.
#
msgid ""
msgstr ""
"Project-Id-Version: po 4a\n"
"POT-Creation-Date: 2023-06-11 15:28+0000\n"
"PO-Revision-Date: 2023-06-11 15:28+0000\n"
"Last-Translator: Automatically generated\n"
"Language-Team: none\n"
"Language: fr\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=2; plural=(n > 1);\n"

#. type: Title #
#: ../src/docs/books/learning_ansible/02-advanced.md:1
#: ../src/docs/books/learning_ansible/02-advanced.md:5
#, no-wrap
msgid "Ansible Intermediate"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:8
msgid "In this chapter you will continue to learn how to work with Ansible."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:12
#, no-wrap
msgid "**Objectives**: In this chapter you will learn how to:\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:17
#, no-wrap
msgid ""
":heavy_check_mark: work with variables;       \n"
":heavy_check_mark: use loops;   \n"
":heavy_check_mark: manage state changes and react to them;   \n"
":heavy_check_mark: manage asynchronous tasks.\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:19
msgid ":checkered_flag: **ansible**, **module**, **playbook**"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:22
#, no-wrap
msgid ""
"**Knowledge**: :star: :star: :star:     \n"
"**Complexity**: :star: :star:\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:24
#, no-wrap
msgid "**Reading time**: 30 minutes\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:28
msgid ""
"In the previous chapter, you learned how to install Ansible, use it on the "
"command line, or how to write playbooks to promote the re-usability of your "
"code."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:30
msgid ""
"In this chapter, we can start to discover some more advanced notions of how "
"to use Ansible, and discover some interesting tasks that you will use very "
"regularly."
msgstr ""

#. type: Title ##
#: ../src/docs/books/learning_ansible/02-advanced.md:31
#, no-wrap
msgid "The variables"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:34
#: ../src/docs/books/learning_ansible/02-advanced.md:150
#: ../src/docs/books/learning_ansible/02-advanced.md:182
#: ../src/docs/books/learning_ansible/02-advanced.md:269
#: ../src/docs/books/learning_ansible/02-advanced.md:277
#: ../src/docs/books/learning_ansible/02-advanced.md:287
#: ../src/docs/books/learning_ansible/02-advanced.md:293
#: ../src/docs/books/learning_ansible/02-advanced.md:360
#: ../src/docs/books/learning_ansible/02-advanced.md:428
#: ../src/docs/books/learning_ansible/02-advanced.md:601
msgid "!!! Note"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:36
#, no-wrap
msgid "    More information can be [found here](https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html).\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:38
msgid "Under Ansible, there are different types of primitive variables:"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:42
msgid "strings,"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:42
msgid "integers,"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:42
msgid "booleans."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:44
msgid "These variables can be organized as:"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:47
msgid "dictionaries,"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:47
msgid "lists."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:49
msgid ""
"A variable can be defined in different places, like in a playbook, in a role "
"or from the command line for example."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:51
msgid "For example, from a playbook:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:52
#, no-wrap
msgid ""
"---\n"
"- hosts: apache1\n"
"  vars:\n"
"    port_http: 80\n"
"    service:\n"
"      debian: apache2\n"
"      rhel: httpd\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:63
msgid "or from the command line:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:64
#, no-wrap
msgid "$ ansible-playbook deploy-http.yml --extra-vars \"service=httpd\"\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:69
msgid ""
"Once defined, a variable can be used by calling it between double braces:"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:72
msgid "`{{ port_http }}` for a simple value,"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:72
msgid "`{{ service['rhel'] }}` or `{{ service.rhel }}` for a dictionary."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:74
msgid "For example:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:75
#, no-wrap
msgid ""
"- name: make sure apache is started\n"
"  ansible.builtin.systemd:\n"
"    name: \"{{ service['rhel'] }}\"\n"
"    state: started\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:83
msgid ""
"Of course, it is also possible to access the global variables (the "
"**facts**) of Ansible (OS type, IP addresses, VM name, etc.)."
msgstr ""

#. type: Title ###
#: ../src/docs/books/learning_ansible/02-advanced.md:84
#, no-wrap
msgid "Outsourcing variables"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:87
msgid ""
"Variables can be included in a file external to the playbook, in which case "
"this file must be defined in the playbook with the `vars_files` directive:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:88
#, no-wrap
msgid ""
"---\n"
"- hosts: apache1\n"
"  vars_files:\n"
"    - myvariables.yml\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:96
msgid "The `myvariables.yml` file:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:97
#, no-wrap
msgid ""
"---\n"
"port_http: 80\n"
"ansible.builtin.systemd::\n"
"  debian: apache2\n"
"  rhel: httpd\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:106
msgid ""
"It can also be added dynamically with the use of the module `include_vars`:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:107
#, no-wrap
msgid ""
"- name: Include secrets.\n"
"  ansible.builtin.include_vars:\n"
"    file: vault.yml\n"
msgstr ""

#. type: Title ###
#: ../src/docs/books/learning_ansible/02-advanced.md:113
#, no-wrap
msgid "Display a variable"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:116
msgid ""
"To display a variable, you have to activate the `debug` module as follows:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:117
#, no-wrap
msgid ""
"- ansible.builtin.debug:\n"
"    var: \"{{ service['debian'] }}\"\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:123
msgid "You can also use the variable inside a text:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:124
#, no-wrap
msgid ""
"- ansible.builtin.debug:\n"
"    msg: \"Print a variable in a message : {{ service['debian'] }}\"\n"
msgstr ""

#. type: Title ###
#: ../src/docs/books/learning_ansible/02-advanced.md:129
#, no-wrap
msgid "Save the return of a task"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:132
msgid ""
"To save the return of a task and to be able to access it later, you have to "
"use the keyword `register` inside the task itself."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:134
msgid "Use of a stored variable:"
msgstr ""

#. type: Bullet: '- '
#: ../src/docs/books/learning_ansible/02-advanced.md:135
#: ../src/docs/books/learning_ansible/02-advanced.md:225
msgid "name: /home content shell: ls /home register: homes"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:135
#, no-wrap
msgid ""
"\n"
"- name: Print the first directory name\n"
"  ansible.builtin.debug:\n"
"    var: homes.stdout_lines[0]\n"
"\n"
"- name: Print the first directory name\n"
"  ansible.builtin.debug:\n"
"    var: homes.stdout_lines[1]\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:152
#, no-wrap
msgid "    The variable `homes.stdout_lines` is a list of variables of type string, a way to organize variables that we had not yet encountered.\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:154
msgid ""
"The strings that make up the stored variable can be accessed via the "
"`stdout` value (which allows you to do things like `homes.stdout.find(\"core"
"\") != -1`), to exploit them using a loop (see `loop`), or simply by their "
"indices as seen in the previous example."
msgstr ""

#. type: Title ###
#: ../src/docs/books/learning_ansible/02-advanced.md:155
#: ../src/docs/books/learning_ansible/02-advanced.md:272
#: ../src/docs/books/learning_ansible/02-advanced.md:353
#, no-wrap
msgid "Exercises"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:158
msgid ""
"Write a playbook `play-vars.yml` that prints the distribution name of the "
"target with its major version, using global variables."
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:160
#: ../src/docs/books/learning_ansible/02-advanced.md:501
msgid ""
"Write a playbook using the following dictionary to display the services that "
"will be installed:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:161
#: ../src/docs/books/learning_ansible/02-advanced.md:502
#, no-wrap
msgid ""
"service:\n"
"  web:\n"
"    name: apache\n"
"    rpm: httpd\n"
"  db:\n"
"    name: mariadb\n"
"    rpm: mariadb-server\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:172
#: ../src/docs/books/learning_ansible/02-advanced.md:513
msgid "The default type should be \"web\"."
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:174
msgid "Override the `type` variable using the command line"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:176
#: ../src/docs/books/learning_ansible/02-advanced.md:572
msgid "Externalize variables in a `vars.yml` file"
msgstr ""

#. type: Title ##
#: ../src/docs/books/learning_ansible/02-advanced.md:177
#, no-wrap
msgid "Loop management"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:180
msgid ""
"With the help of loop, you can iterate a task over a list, a hash, or "
"dictionary for example."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:184
#, no-wrap
msgid "    More information can be [found here](https://docs.ansible.com/ansible/latest/user_guide/playbooks_loops.html).\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:186
msgid "Simple example of use, creation of 4 users:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:187
#, no-wrap
msgid ""
"- name: add users\n"
"  user:\n"
"    name: \"{{ item }}\"\n"
"    state: present\n"
"    groups: \"users\"\n"
"  loop:\n"
"     - antoine\n"
"     - patrick\n"
"     - steven\n"
"     - xavier\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:201
msgid ""
"At each iteration of the loop, the value of the list used is stored in the "
"`item` variable, accessible in the loop code."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:203
msgid "Of course, a list can be defined in an external file:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:204
#, no-wrap
msgid ""
"users:\n"
"  - antoine\n"
"  - patrick\n"
"  - steven\n"
"  - xavier\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:213
msgid ""
"and be used inside the task like this (after having include the vars file):"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:214
#, no-wrap
msgid ""
"- name: add users\n"
"  user:\n"
"    name: \"{{ item }}\"\n"
"    state: present\n"
"    groups: \"users\"\n"
"  loop: \"{{ users }}\"\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:224
msgid ""
"We can use the example seen during the study of stored variables to improve "
"it. Use of a stored variable:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:225
#, no-wrap
msgid ""
"\n"
"- name: Print the directories name\n"
"  ansible.builtin.debug:\n"
"    msg: \"Directory => {{ item }}\"\n"
"  loop: \"{{ homes.stdout_lines }}\"\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:237
msgid "A dictionary can also be used in a loop."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:239
msgid ""
"In this case, you will have to transform the dictionary into an item with "
"what is called a **jinja filter** (jinja is the templating engine used by "
"Ansible): `| dict2items`."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:241
msgid ""
"In the loop, it becomes possible to use `item.key` which corresponds to the "
"dictionary key, and `item.value` which corresponds to the values of the key."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:243
msgid ""
"Let's see this through a concrete example, showing the management of the "
"system users:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:244
#, no-wrap
msgid ""
"---\n"
"- hosts: rocky8\n"
"  become: true\n"
"  become_user: root\n"
"  vars:\n"
"    users:\n"
"      antoine:\n"
"        group: users\n"
"        state: present\n"
"      steven:\n"
"        group: users\n"
"        state: absent\n"
"\n"
"  tasks:\n"
"\n"
"  - name: Manage users\n"
"    user:\n"
"      name: \"{{ item.key }}\"\n"
"      group: \"{{ item.value.group }}\"\n"
"      state: \"{{ item.value.state }}\"\n"
"    loop: \"{{ users | dict2items }}\"\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:271
#, no-wrap
msgid "    Many things can be done with the loops. You will discover the possibilities offered by loops when your use of Ansible pushes you to use them in a more complex way.\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:275
#: ../src/docs/books/learning_ansible/02-advanced.md:599
msgid ""
"Display the content of the `service` variable from the previous exercise "
"using a loop."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:279
#, no-wrap
msgid "    You will have to transform your `service` variable, which is a dictionary, to a list with the help of the jinja filter `list` as this:\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:283
#: ../src/docs/books/learning_ansible/02-advanced.md:611
#, no-wrap
msgid ""
"    ```\n"
"    {{ service.values() | list }}\n"
"    ```\n"
msgstr ""

#. type: Title ##
#: ../src/docs/books/learning_ansible/02-advanced.md:284
#, no-wrap
msgid "Conditionals"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:289
#, no-wrap
msgid "    More information can be [found here](https://docs.ansible.com/ansible/latest/user_guide/playbooks_conditionals.html).\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:291
msgid ""
"The `when` statement is very useful in many cases: not performing certain "
"actions on certain types of servers, if a file or a user does not exist, etc."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:295
#, no-wrap
msgid "    Behind the `when` statement the variables do not need double braces (they are in fact Jinja2 expressions...).\n"
msgstr ""

#. type: Bullet: '- '
#: ../src/docs/books/learning_ansible/02-advanced.md:296
msgid ""
"name: \"Reboot only Debian servers\" reboot: when: ansible_os_family == "
"\"Debian\""
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:303
msgid "Conditions can be grouped with parentheses:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:304
#, no-wrap
msgid ""
"- name: \"Reboot only CentOS version 6 and Debian version 7\"\n"
"  reboot:\n"
"  when: (ansible_distribution == \"CentOS\" and ansible_distribution_major_version == \"6\") or\n"
"        (ansible_distribution == \"Debian\" and ansible_distribution_major_version == \"7\")\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:312
msgid ""
"The conditions corresponding to a logical AND can be provided as a list:"
msgstr ""

#. type: Bullet: '- '
#: ../src/docs/books/learning_ansible/02-advanced.md:313
msgid "name: \"Reboot only CentOS version 6\" reboot: when:"
msgstr ""

#. type: Bullet: '    - '
#: ../src/docs/books/learning_ansible/02-advanced.md:313
msgid "ansible_distribution == \"CentOS\""
msgstr ""

#. type: Bullet: '    - '
#: ../src/docs/books/learning_ansible/02-advanced.md:313
msgid "ansible_distribution_major_version == \"6\""
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:322
msgid "You can test the value of a boolean and verify that it is true:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:323
#, no-wrap
msgid ""
"- name: check if directory exists\n"
"  stat:\n"
"    path: /home/ansible\n"
"  register: directory\n"
"\n"
"- ansible.builtin.debug:\n"
"    var: directory\n"
"\n"
"- ansible.builtin.debug:\n"
"    msg: The directory exists\n"
"  when:\n"
"    - directory.stat.exists\n"
"    - directory.stat.isdir\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:340
msgid "You can also test that it is not true:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:341
#, no-wrap
msgid ""
"  when:\n"
"    - file.stat.exists\n"
"    - not file.stat.isdir\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:348
msgid ""
"You will probably have to test that a variable exists to avoid execution "
"errors:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:349
#, no-wrap
msgid "  when: myboolean is defined and myboolean\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:356
#: ../src/docs/books/learning_ansible/02-advanced.md:687
msgid "Print the value of `service.web` only when `type` equals to `web`."
msgstr ""

#. type: Title ##
#: ../src/docs/books/learning_ansible/02-advanced.md:357
#, no-wrap
msgid "Managing changes: the `handlers`"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:362
#, no-wrap
msgid "    More information can be [found here](https://docs.ansible.com/ansible/latest/user_guide/playbooks_handlers.html).\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:364
msgid ""
"Handlers allow to launch operations, like restarting a service, when changes "
"occur."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:366
msgid ""
"A module, being idempotent, a playbook can detect that there has been a "
"significant change on a remote system, and thus trigger an operation in "
"reaction to this change. A notification is sent at the end of a playbook "
"task block, and the reaction operation will be triggered only once even if "
"several tasks send the same notification."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:368
msgid "![Handlers](images/handlers.png)"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:370
msgid ""
"For example, several tasks may indicate that the `httpd` service needs to be "
"restarted due to a change in its configuration files. But the service will "
"only be restarted once to avoid multiple unnecessary starts."
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:371
#, no-wrap
msgid ""
"- name: template configuration file\n"
"  template:\n"
"    src: template-site.j2\n"
"    dest: /etc/httpd/sites-availables/test-site.conf\n"
"  notify:\n"
"     - restart memcached\n"
"     - restart httpd\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:382
msgid "A handler is a kind of task referenced by a unique global name:"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:385
msgid "It is activated by one or more notifiers."
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:385
msgid ""
"It does not start immediately, but waits until all tasks are complete to run."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:387
msgid "Example of handlers:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:388
#, no-wrap
msgid ""
"handlers:\n"
"\n"
"  - name: restart memcached\n"
"    systemd:\n"
"      name: memcached\n"
"      state: restarted\n"
"\n"
"  - name: restart httpd\n"
"    systemd:\n"
"      name: httpd\n"
"      state: restarted\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:403
msgid "Since version 2.2 of Ansible, handlers can listen directly as well:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:404
#, no-wrap
msgid ""
"handlers:\n"
"\n"
"  - name: restart memcached\n"
"    systemd:\n"
"      name: memcached\n"
"      state: restarted\n"
"    listen: \"web services restart\"\n"
"\n"
"  - name: restart apache\n"
"    systemd:\n"
"      name: apache\n"
"      state: restarted\n"
"    listen: \"web services restart\"\n"
"\n"
"tasks:\n"
"    - name: restart everything\n"
"      command: echo \"this task will restart the web services\"\n"
"      notify: \"web services restart\"\n"
msgstr ""

#. type: Title ##
#: ../src/docs/books/learning_ansible/02-advanced.md:425
#, no-wrap
msgid "Asynchronous tasks"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:430
#, no-wrap
msgid "    More information can be [found here](https://docs.ansible.com/ansible/latest/user_guide/playbooks_async.html).\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:432
msgid ""
"By default, SSH connections to hosts remain open during the execution of "
"various playbook tasks on all nodes."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:434
msgid "This can cause some problems, especially:"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:437
msgid ""
"if the execution time of the task is longer than the SSH connection timeout"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:437
msgid ""
"if the connection is interrupted during the action (server reboot for "
"example)"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:439
msgid ""
"In this case, you will have to switch to asynchronous mode and specify a "
"maximum execution time as well as the frequency (by default 10s) with which "
"you will check the host status."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:441
msgid ""
"By specifying a poll value of 0, Ansible will execute the task and continue "
"without worrying about the result."
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:443
msgid ""
"Here's an example using asynchronous tasks, which allows you to restart a "
"server and wait for port 22 to be reachable again:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:444
#, no-wrap
msgid ""
"# Wait 2s and launch the reboot\n"
"- name: Reboot system\n"
"  shell: sleep 2 && shutdown -r now \"Ansible reboot triggered\"\n"
"  async: 1\n"
"  poll: 0\n"
"  ignore_errors: true\n"
"  become: true\n"
"  changed_when: False\n"
"\n"
"  # Wait the server is available\n"
"  - name: Waiting for server to restart (10 mins max)\n"
"    wait_for:\n"
"      host: \"{{ inventory_hostname }}\"\n"
"      port: 22\n"
"      delay: 30\n"
"      state: started\n"
"      timeout: 600\n"
"    delegate_to: localhost\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:466
msgid ""
"You can also decide to launch a long-running task and forget it (fire and "
"forget) because the execution does not matter in the playbook."
msgstr ""

#. type: Title ##
#: ../src/docs/books/learning_ansible/02-advanced.md:467
#, no-wrap
msgid "Exercise results"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:470
msgid ""
"Write a playbook `play-vars.yml` that print the distribution name of the "
"target with its major version, using global variables."
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:471
#, no-wrap
msgid ""
"---\n"
"- hosts: ansible_clients\n"
"\n"
"  tasks:\n"
"\n"
"    - name: Print globales variables\n"
"      debug:\n"
"        msg: \"The distribution is {{ ansible_distribution }} version {{ ansible_distribution_major_version }}\"\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:482
#, no-wrap
msgid ""
"$ ansible-playbook play-vars.yml\n"
"\n"
"PLAY [ansible_clients] *********************************************************************************\n"
"\n"
"TASK [Gathering Facts] *********************************************************************************\n"
"ok: [192.168.1.11]\n"
"\n"
"TASK [Print globales variables] ************************************************************************\n"
"ok: [192.168.1.11] => {\n"
"    \"msg\": \"The distribution is Rocky version 8\"\n"
"}\n"
"\n"
"PLAY RECAP *********************************************************************************************\n"
"192.168.1.11               : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n"
"\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:514
#, no-wrap
msgid ""
"---\n"
"- hosts: ansible_clients\n"
"  vars:\n"
"    type: web\n"
"    service:\n"
"      web:\n"
"        name: apache\n"
"        rpm: httpd\n"
"      db:\n"
"        name: mariadb\n"
"        rpm: mariadb-server\n"
"\n"
"  tasks:\n"
"\n"
"    - name: Print a specific entry of a dictionary\n"
"      debug:\n"
"        msg: \"The {{ service[type]['name'] }} will be installed with the packages {{ service[type].rpm }}\"\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:534
#, no-wrap
msgid ""
"$ ansible-playbook display-dict.yml\n"
"\n"
"PLAY [ansible_clients] *********************************************************************************\n"
"\n"
"TASK [Gathering Facts] *********************************************************************************\n"
"ok: [192.168.1.11]\n"
"\n"
"TASK [Print a specific entry of a dictionnaire] ********************************************************\n"
"ok: [192.168.1.11] => {\n"
"    \"msg\": \"The apache will be installed with the packages httpd\"\n"
"}\n"
"\n"
"PLAY RECAP *********************************************************************************************\n"
"192.168.1.11               : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n"
"\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/02-advanced.md:553
msgid "Override the `type` variable using the command line:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:554
#, no-wrap
msgid ""
"ansible-playbook --extra-vars \"type=db\" display-dict.yml\n"
"\n"
"PLAY [ansible_clients] *********************************************************************************\n"
"\n"
"TASK [Gathering Facts] *********************************************************************************\n"
"ok: [192.168.1.11]\n"
"\n"
"TASK [Print a specific entry of a dictionary] ********************************************************\n"
"ok: [192.168.1.11] => {\n"
"    \"msg\": \"The mariadb will be installed with the packages mariadb-server\"\n"
"}\n"
"\n"
"PLAY RECAP *********************************************************************************************\n"
"192.168.1.11               : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:573
#, no-wrap
msgid ""
"type: web\n"
"service:\n"
"  web:\n"
"    name: apache\n"
"    rpm: httpd\n"
"  db:\n"
"    name: mariadb\n"
"    rpm: mariadb-server\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:584
#, no-wrap
msgid ""
"---\n"
"- hosts: ansible_clients\n"
"  vars_files:\n"
"    - vars.yml\n"
"\n"
"  tasks:\n"
"\n"
"    - name: Print a specific entry of a dictionary\n"
"      debug:\n"
"        msg: \"The {{ service[type]['name'] }} will be installed with the packages {{ service[type].rpm }}\"\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:603
#, no-wrap
msgid "    You will have to transform your `service` variable, which is a dictionary, to an item or a list with the help of the jinja filters `dict2items` or `list` as this:\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:607
#, no-wrap
msgid ""
"    ```\n"
"    {{ service | dict2items }}\n"
"    ```\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:613
msgid "With `dict2items`:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:614
#, no-wrap
msgid ""
"---\n"
"- hosts: ansible_clients\n"
"  vars_files:\n"
"    - vars.yml\n"
"\n"
"  tasks:\n"
"\n"
"    - name: Print a dictionary variable with a loop\n"
"      debug:\n"
"        msg: \"{{item.key }} | The {{ item.value.name }} will be installed with the packages {{ item.value.rpm }}\"\n"
"      loop: \"{{ service | dict2items }}\"              \n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:628
#, no-wrap
msgid ""
"$ ansible-playbook display-dict.yml\n"
"\n"
"PLAY [ansible_clients] *********************************************************************************\n"
"\n"
"TASK [Gathering Facts] *********************************************************************************\n"
"ok: [192.168.1.11]\n"
"\n"
"TASK [Print a dictionary variable with a loop] ********************************************************\n"
"ok: [192.168.1.11] => (item={'key': 'web', 'value': {'name': 'apache', 'rpm': 'httpd'}}) => {\n"
"    \"msg\": \"web | The apache will be installed with the packages httpd\"\n"
"}\n"
"ok: [192.168.1.11] => (item={'key': 'db', 'value': {'name': 'mariadb', 'rpm': 'mariadb-server'}}) => {\n"
"    \"msg\": \"db | The mariadb will be installed with the packages mariadb-server\"\n"
"}\n"
"\n"
"PLAY RECAP *********************************************************************************************\n"
"192.168.1.11               : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n"
"\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/02-advanced.md:650
msgid "With `list`:"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:651
#, no-wrap
msgid ""
"---\n"
"- hosts: ansible_clients\n"
"  vars_files:\n"
"    - vars.yml\n"
"\n"
"  tasks:\n"
"\n"
"    - name: Print a dictionary variable with a loop\n"
"      debug:\n"
"        msg: \"The {{ item.name }} will be installed with the packages {{ item.rpm }}\"\n"
"      loop: \"{{ service.values() | list}}\"\n"
"~                                                 \n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:666
#, no-wrap
msgid ""
"$ ansible-playbook display-dict.yml\n"
"\n"
"PLAY [ansible_clients] *********************************************************************************\n"
"\n"
"TASK [Gathering Facts] *********************************************************************************\n"
"ok: [192.168.1.11]\n"
"\n"
"TASK [Print a dictionary variable with a loop] ********************************************************\n"
"ok: [192.168.1.11] => (item={'name': 'apache', 'rpm': 'httpd'}) => {\n"
"    \"msg\": \"The apache will be installed with the packages httpd\"\n"
"}\n"
"ok: [192.168.1.11] => (item={'name': 'mariadb', 'rpm': 'mariadb-server'}) => {\n"
"    \"msg\": \"The mariadb will be installed with the packages mariadb-server\"\n"
"}\n"
"\n"
"PLAY RECAP *********************************************************************************************\n"
"192.168.1.11               : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:688
#, no-wrap
msgid ""
"---\n"
"- hosts: ansible_clients\n"
"  vars_files:\n"
"    - vars.yml\n"
"\n"
"  tasks:\n"
"\n"
"    - name: Print a dictionary variable\n"
"      debug:\n"
"        msg: \"The {{ service.web.name }} will be installed with the packages {{ service.web.rpm }}\"\n"
"      when: type == \"web\"\n"
"\n"
"\n"
"    - name: Print a dictionary variable\n"
"      debug:\n"
"        msg: \"The {{ service.db.name }} will be installed with the packages {{ service.db.rpm }}\"\n"
"      when: type == \"db\"\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/02-advanced.md:708
#, no-wrap
msgid ""
"$ ansible-playbook display-dict.yml\n"
"\n"
"PLAY [ansible_clients] *********************************************************************************\n"
"\n"
"TASK [Gathering Facts] *********************************************************************************\n"
"ok: [192.168.1.11]\n"
"\n"
"TASK [Print a dictionary variable] ********************************************************************\n"
"ok: [192.168.1.11] => {\n"
"    \"msg\": \"The apache will be installed with the packages httpd\"\n"
"}\n"
"\n"
"TASK [Print a dictionary variable] ********************************************************************\n"
"skipping: [192.168.1.11]\n"
"\n"
"PLAY RECAP *********************************************************************************************\n"
"192.168.1.11               : ok=2    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   \n"
"\n"
"$ ansible-playbook --extra-vars \"type=db\" display-dict.yml\n"
"\n"
"PLAY [ansible_clients] *********************************************************************************\n"
"\n"
"TASK [Gathering Facts] *********************************************************************************\n"
"ok: [192.168.1.11]\n"
"\n"
"TASK [Print a dictionary variable] ********************************************************************\n"
"skipping: [192.168.1.11]\n"
"\n"
"TASK [Print a dictionary variable] ********************************************************************\n"
"ok: [192.168.1.11] => {\n"
"    \"msg\": \"The mariadb will be installed with the packages mariadb-server\"\n"
"}\n"
"\n"
"PLAY RECAP *********************************************************************************************\n"
"192.168.1.11               : ok=2    changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   \n"
msgstr ""
