msgid ""
msgstr ""
"Project-Id-Version: rockypo4a\n"
"POT-Creation-Date: 2023-06-16 16:28+0000\n"
"PO-Revision-Date: 2023-06-16 17:24\n"
"Last-Translator: \n"
"Language-Team: Italian\n"
"Language: it_IT\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=2; plural=(n != 1);\n"
"X-Crowdin-Project: rockypo4a\n"
"X-Crowdin-Project-ID: 593059\n"
"X-Crowdin-Language: it\n"
"X-Crowdin-File: /po4a/po4a/_po/learning_ansible_05-deployments.pot\n"
"X-Crowdin-File-ID: 1389\n"

#. type: Plain text
#: ../src/docs/books/admin_guide/01-presentation.md:12
#: ../src/docs/books/admin_guide/12-network.md:12
#: ../src/docs/books/learning_ansible/01-basic.md:15
#: ../src/docs/books/learning_ansible/02-advanced.md:12
#: ../src/docs/books/learning_ansible/03-working-with-files.md:12
#: ../src/docs/books/learning_ansible/04-ansible-galaxy.md:12
#: ../src/docs/books/learning_ansible/05-deployments.md:12
#: ../src/docs/books/learning_ansible/06-large-scale-infrastructure.md:12
#: ../src/docs/books/learning_ansible/07-working-with-filters.md:14
#: ../src/docs/books/learning_bash/01-first-script.md:19
#: ../src/docs/books/learning_bash/02-using-variables.md:19
#: ../src/docs/books/learning_bash/03-data-entry-and-manipulations.md:19
#: ../src/docs/books/learning_bash/05-tests.md:17
#: ../src/docs/books/learning_bash/06-conditional-structures.md:17
#: ../src/docs/books/learning_bash/07-loops.md:17
#, no-wrap
msgid "**Objectives**: In this chapter you will learn how to:\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/admin_guide/04-advanced-commands.md:43
#: ../src/docs/books/admin_guide/04-advanced-commands.md:220
#: ../src/docs/books/admin_guide/04-advanced-commands.md:271
#: ../src/docs/books/admin_guide/04-advanced-commands.md:334
#: ../src/docs/books/admin_guide/05-vi.md:70
#: ../src/docs/books/admin_guide/05-vi.md:206
#: ../src/docs/books/admin_guide/05-vi.md:272
#: ../src/docs/books/admin_guide/06-users.md:36
#: ../src/docs/books/admin_guide/06-users.md:92
#: ../src/docs/books/admin_guide/06-users.md:220
#: ../src/docs/books/admin_guide/06-users.md:350
#: ../src/docs/books/admin_guide/06-users.md:598
#: ../src/docs/books/admin_guide/06-users.md:754
#: ../src/docs/books/admin_guide/06-users.md:818
#: ../src/docs/books/admin_guide/11-tasks.md:174
#: ../src/docs/books/admin_guide/12-network.md:158
#: ../src/docs/books/admin_guide/03-commands.md:516
#: ../src/docs/books/admin_guide/03-commands.md:693
#: ../src/docs/books/admin_guide/03-commands.md:1216
#: ../src/docs/books/admin_guide/03-commands.md:1262
#: ../src/docs/books/admin_guide/03-commands.md:1297
#: ../src/docs/books/admin_guide/07-file-systems.md:395
#: ../src/docs/books/admin_guide/07-file-systems.md:437
#: ../src/docs/books/admin_guide/07-file-systems.md:447
#: ../src/docs/books/admin_guide/07-file-systems.md:515
#: ../src/docs/books/admin_guide/07-file-systems.md:556
#: ../src/docs/books/admin_guide/07-file-systems.md:627
#: ../src/docs/books/admin_guide/07-file-systems.md:653
#: ../src/docs/books/admin_guide/07-file-systems.md:672
#: ../src/docs/books/admin_guide/07-file-systems.md:676
#: ../src/docs/books/admin_guide/07-file-systems.md:1019
#: ../src/docs/books/admin_guide/08-process.md:49
#: ../src/docs/books/admin_guide/08-process.md:238
#: ../src/docs/books/admin_guide/09-backups.md:27
#: ../src/docs/books/admin_guide/09-backups.md:116
#: ../src/docs/books/admin_guide/09-backups.md:133
#: ../src/docs/books/admin_guide/09-backups.md:148
#: ../src/docs/books/admin_guide/09-backups.md:281
#: ../src/docs/books/admin_guide/09-backups.md:285
#: ../src/docs/books/admin_guide/09-backups.md:301
#: ../src/docs/books/admin_guide/09-backups.md:342
#: ../src/docs/books/admin_guide/09-backups.md:352
#: ../src/docs/books/admin_guide/09-backups.md:554
#: ../src/docs/books/admin_guide/09-backups.md:771
#: ../src/docs/books/admin_guide/10-boot.md:114
#: ../src/docs/books/admin_guide/10-boot.md:153
#: ../src/docs/books/admin_guide/10-boot.md:165
#: ../src/docs/books/admin_guide/13-softwares.md:22
#: ../src/docs/books/learning_ansible/01-basic.md:51
#: ../src/docs/books/learning_ansible/01-basic.md:104
#: ../src/docs/books/learning_ansible/01-basic.md:112
#: ../src/docs/books/learning_ansible/01-basic.md:328
#: ../src/docs/books/learning_ansible/01-basic.md:415
#: ../src/docs/books/learning_ansible/01-basic.md:492
#: ../src/docs/books/learning_ansible/01-basic.md:633
#: ../src/docs/books/learning_ansible/01-basic.md:656
#: ../src/docs/books/learning_ansible/02-advanced.md:34
#: ../src/docs/books/learning_ansible/02-advanced.md:150
#: ../src/docs/books/learning_ansible/02-advanced.md:182
#: ../src/docs/books/learning_ansible/02-advanced.md:269
#: ../src/docs/books/learning_ansible/02-advanced.md:277
#: ../src/docs/books/learning_ansible/02-advanced.md:287
#: ../src/docs/books/learning_ansible/02-advanced.md:293
#: ../src/docs/books/learning_ansible/02-advanced.md:360
#: ../src/docs/books/learning_ansible/02-advanced.md:428
#: ../src/docs/books/learning_ansible/02-advanced.md:601
#: ../src/docs/books/learning_ansible/03-working-with-files.md:33
#: ../src/docs/books/learning_ansible/03-working-with-files.md:58
#: ../src/docs/books/learning_ansible/03-working-with-files.md:77
#: ../src/docs/books/learning_ansible/03-working-with-files.md:96
#: ../src/docs/books/learning_ansible/03-working-with-files.md:113
#: ../src/docs/books/learning_ansible/04-ansible-galaxy.md:65
#: ../src/docs/books/learning_ansible/04-ansible-galaxy.md:432
#: ../src/docs/books/learning_ansible/05-deployments.md:41
#: ../src/docs/books/learning_ansible/05-deployments.md:124
#: ../src/docs/books/learning_ansible/05-deployments.md:196
#: ../src/docs/books/learning_ansible/05-deployments.md:616
#: ../src/docs/books/learning_ansible/06-large-scale-infrastructure.md:36
#: ../src/docs/books/learning_ansible/06-large-scale-infrastructure.md:40
#: ../src/docs/books/learning_ansible/06-large-scale-infrastructure.md:80
#: ../src/docs/books/learning_ansible/06-large-scale-infrastructure.md:214
#: ../src/docs/books/learning_ansible/07-working-with-filters.md:32
#: ../src/docs/books/learning_ansible/07-working-with-filters.md:75
#: ../src/docs/books/learning_bash/02-using-variables.md:153
#: ../src/docs/books/learning_bash/02-using-variables.md:193
#: ../src/docs/books/learning_bash/05-tests.md:245
#: ../src/docs/books/learning_bash/07-loops.md:180
#: ../src/docs/books/lxd_server/04-firewall.md:80
#: ../src/docs/books/nvchad/plugins/md_preview.md:140
#: ../src/docs/books/nvchad/template_chadrc.md:239
#: ../src/docs/gemstones/https_rsa_keygen.md:34
#: ../src/docs/gemstones/systemd_service_for_python_script.md:80
#: ../src/docs/guides/8_6_installation.md:37
#: ../src/docs/guides/8_6_installation.md:168
#: ../src/docs/guides/8_6_installation.md:176
#: ../src/docs/guides/8_6_installation.md:182
#: ../src/docs/guides/8_6_installation.md:250
#: ../src/docs/guides/automation/olivetin.md:60
#: ../src/docs/guides/automation/templates-automation-packer-vsphere.md:307
#: ../src/docs/guides/automation/templates-automation-packer-vsphere.md:323
#: ../src/docs/guides/automation/templates-automation-packer-vsphere.md:486
#: ../src/docs/guides/automation/templates-automation-packer-vsphere.md:533
#: ../src/docs/guides/automation/templates-automation-packer-vsphere.md:667
#: ../src/docs/guides/containers/lxd_web_servers.md:35
#: ../src/docs/guides/containers/lxd_web_servers.md:45
#: ../src/docs/guides/containers/lxd_web_servers.md:301
#: ../src/docs/guides/containers/lxd_web_servers.md:352
#: ../src/docs/guides/containers/lxd_web_servers.md:605
#: ../src/docs/guides/containers/lxd_web_servers.md:665
#: ../src/docs/guides/containers/lxd_web_servers.md:737
#: ../src/docs/guides/containers/lxd_web_servers.md:796
#: ../src/docs/guides/contribute/mkdocs_lsyncd.md:53
#: ../src/docs/guides/contribute/navigation.md:60
#: ../src/docs/guides/custom-linux-kernel.md:453
#: ../src/docs/guides/editors/micro.md:30
#: ../src/docs/guides/file_sharing/glusterfs.md:46
#: ../src/docs/guides/file_sharing/glusterfs.md:64
#: ../src/docs/guides/file_sharing/glusterfs.md:102
#: ../src/docs/guides/file_sharing/glusterfs.md:203
#: ../src/docs/guides/installation.md:36 ../src/docs/guides/installation.md:175
#: ../src/docs/guides/installation.md:183
#: ../src/docs/guides/installation.md:193
#: ../src/docs/guides/installation.md:266
#: ../src/docs/guides/proxies/haproxy_apache_lxd.md:71
#: ../src/docs/guides/security/authentication/active_directory_authentication.md:31
#: ../src/docs/guides/security/authentication/active_directory_authentication.md:253
#: ../src/docs/guides/security/firewalld-beginners.md:89
#: ../src/docs/guides/security/firewalld-beginners.md:144
#: ../src/docs/guides/security/firewalld-beginners.md:258
#: ../src/docs/guides/security/firewalld.md:51
#: ../src/docs/guides/security/firewalld.md:94
#: ../src/docs/guides/security/firewalld.md:228
#: ../src/docs/guides/security/firewalld.md:372
#: ../src/docs/guides/security/generating_ssl_keys_lets_encrypt.md:72
#: ../src/docs/guides/security/learning_selinux.md:137
#: ../src/docs/guides/security/learning_selinux.md:253
#: ../src/docs/guides/security/learning_selinux.md:356
#: ../src/docs/guides/virtualization/vbox-rocky.md:27
#: ../src/docs/guides/web/nginx-mainline.md:30
#: ../src/docs/guides/web/nginx-mainline.md:99
#: ../src/docs/guides/web/nginx-mainline.md:141
#: ../src/docs/guides/web/nginx-mainline.md:254
#: ../src/docs/guides/web/nginx-mainline.md:333
#: ../src/docs/guides/web/nginx-multisite.md:73
#: ../src/docs/guides/web/nginx-multisite.md:233
#: ../src/docs/guides/web/nginx-multisite.md:292
#: ../src/docs/guides/web/nginx-multisite.md:302
#: ../src/docs/guides/web/php.md:33 ../src/docs/guides/web/php.md:76
#: ../src/docs/guides/web/php.md:181 ../src/docs/guides/web/php.md:230
#: ../src/docs/guides/web/php.md:271 ../src/docs/guides/web/php.md:467
#: ../src/docs/guides/web/php.md:471 ../src/docs/release_notes/9_2.md:26
#, no-wrap
msgid "!!! Note\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/admin_guide/03-commands.md:25
#: ../src/docs/books/admin_guide/09-backups.md:23
#: ../src/docs/books/learning_ansible/04-ansible-galaxy.md:22
#: ../src/docs/books/learning_ansible/05-deployments.md:25
#, no-wrap
msgid "**Reading time**: 40 minutes\n"
msgstr ""

#. type: Title #
#: ../src/docs/books/disa_stig/disa_stig_part2.md:13
#: ../src/docs/books/disa_stig/disa_stig_part1.md:23
#: ../src/docs/books/learning_ansible/05-deployments.md:31
#: ../src/docs/books/learning_bash/appendix/02-variables-logs.md:14
#: ../src/docs/books/lxd_server/00-toc.md:1
#: ../src/docs/books/lxd_server/00-toc.md:13
#: ../src/docs/books/nvchad/index.md:12
#: ../src/docs/books/nvchad/plugins/index.md:14
#: ../src/docs/books/nvchad/plugins/md_preview.md:14
#: ../src/docs/books/nvchad/plugins/projectmgr.md:14
#: ../src/docs/books/nvchad/vale_nvchad.md:12
#: ../src/docs/gemstones/dnf-swap.md:18 ../src/docs/gemstones/docker.md:10
#: ../src/docs/gemstones/nmtui.md:8 ../src/docs/gemstones/setup_local_repo.md:8
#: ../src/docs/gemstones/string_color.md:11
#: ../src/docs/guides/automation/cron_jobs_howto.md:25
#: ../src/docs/guides/automation/olivetin.md:14
#: ../src/docs/guides/automation/templates-automation-packer-vsphere.md:25
#: ../src/docs/guides/backup/mirroring_lsyncd.md:26
#: ../src/docs/guides/backup/rsnapshot_backup.md:22
#: ../src/docs/guides/backup/rsync_ssh.md:24
#: ../src/docs/guides/cms/cloud_server_using_nextcloud.md:28
#: ../src/docs/guides/cms/dokuwiki_server.md:23
#: ../src/docs/guides/containers/lxd_web_servers.md:10
#: ../src/docs/guides/containers/podman-nextcloud.md:13
#: ../src/docs/guides/contribute/local_docs.md:11
#: ../src/docs/guides/contribute/mkdocs_lsyncd.md:11
#: ../src/docs/guides/contribute/mkdocs_venv.md:14
#: ../src/docs/guides/contribute/style_guide.md:14
#: ../src/docs/guides/database/database_mariadb-server.md:21
#: ../src/docs/guides/desktop/kde_installation.md:11
#: ../src/docs/guides/dns/private_dns_server_using_bind.md:22
#: ../src/docs/guides/editors/micro.md:14
#: ../src/docs/guides/email/postfix_reporting.md:22
#: ../src/docs/guides/file_sharing/glusterfs.md:16
#: ../src/docs/guides/file_sharing/secure_ftp_server_vsftpd.md:21
#: ../src/docs/guides/file_sharing/sftp.md:16
#: ../src/docs/guides/migrate2rocky.md:18
#: ../src/docs/guides/network/basic_network_configuration.md:12
#: ../src/docs/guides/network/librenms_monitoring_server.md:13
#: ../src/docs/guides/package_management/index.md:1
#: ../src/docs/guides/package_management/index.md:5
#: ../src/docs/guides/proxies/haproxy_apache_lxd.md:9
#: ../src/docs/guides/proxies/pound.md:17
#: ../src/docs/guides/security/authentication/active_directory_authentication.md:13
#: ../src/docs/guides/security/enabling_iptables_firewall.md:22
#: ../src/docs/guides/security/firewalld-beginners.md:10
#: ../src/docs/guides/security/generating_ssl_keys_lets_encrypt.md:23
#: ../src/docs/guides/security/ssh_public_private_keys.md:21
#: ../src/docs/guides/security/ssl_keys_https.md:22
#: ../src/docs/guides/virtualization/vbox-rocky.md:13
#: ../src/docs/guides/web/apache-sites-enabled.md:25
#: ../src/docs/guides/web/apache_hardened_webserver/index.md:23
#: ../src/docs/guides/web/apache_hardened_webserver/modsecurity.md:24
#: ../src/docs/guides/web/apache_hardened_webserver/ossec-hids.md:22
#: ../src/docs/guides/web/apache_hardened_webserver/rkhunter.md:23
#: ../src/docs/guides/web/nginx-mainline.md:13
#: ../src/docs/guides/web/nginx-multisite.md:14
#: ../src/docs/labs/security/introduction.md:1
#: ../src/docs/labs/security/introduction.md:5
#, no-wrap
msgid "Introduction"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/04-ansible-galaxy.md:20
#: ../src/docs/books/learning_ansible/05-deployments.md:23
#, no-wrap
msgid "**Knowledge**: :star: :star:      \n"
"**Complexity**: :star: :star: :star:\n"
msgstr ""

#. type: YAML Front Matter: title
#: ../src/docs/books/learning_ansible/05-deployments.md:1
#, no-wrap
msgid "Deploy With Ansistrano"
msgstr ""

#. type: Title #
#: ../src/docs/books/learning_ansible/05-deployments.md:5
#, no-wrap
msgid "Ansible Deployments with Ansistrano"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:8
#, no-wrap
msgid "In this chapter you will learn how to deploy applications with the Ansible role [Ansistrano](https://ansistrano.com).\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:18
#, no-wrap
msgid ":heavy_check_mark: Implement Ansistrano;       \n"
":heavy_check_mark: Configure Ansistrano;       \n"
":heavy_check_mark: Use shared folders and files between deployed versions;       \n"
":heavy_check_mark: Deploying different versions of a site from git;        \n"
":heavy_check_mark: React between deployment steps.          \n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:20
#, no-wrap
msgid ":checkered_flag: **ansible**, **ansistrano**, **roles**, **deployments**\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:30
#, no-wrap
msgid "Ansistrano is an Ansible role to easily deploy PHP, Python, etc. applications.\n"
"It is based on the functionality of [Capistrano](http://capistranorb.com/).\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:34
#, no-wrap
msgid "Ansistrano requires the following to run:\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:37
#, no-wrap
msgid "Ansible on the deployment machine,\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:37
#, no-wrap
msgid "`rsync` or `git` on the client machine.\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:39
#, no-wrap
msgid "It can download source code from `rsync`, `git`, `scp`, `http`, `S3`, ...\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:43
#, no-wrap
msgid "    For our deployment example, we will use the `git` protocol.\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:45
#, no-wrap
msgid "Ansistrano deploys applications by following these 5 steps:\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:50
#, no-wrap
msgid "**Setup**: create the directory structure to host the releases;\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:50
#, no-wrap
msgid "**Update Code**: downloading the new release to the targets;\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:50
#, no-wrap
msgid "**Symlink Shared** and **Symlink**: after deploying the new release, the `current` symbolic link is modified to point to this new release;\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:50
#, no-wrap
msgid "**Clean Up**: to do some clean up (remove old versions).\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:52
#: ../src/docs/books/learning_ansible/05-deployments.md:681
#, no-wrap
msgid "![Stages of a deployment](images/ansistrano-001.png)\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:54
#, no-wrap
msgid "The skeleton of a deployment with Ansistrano looks like this:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:55
#, no-wrap
msgid "/var/www/site/\n"
"├── current -> ./releases/20210718100000Z\n"
"├── releases\n"
"│   └── 20210718100000Z\n"
"│       ├── css -> ../../shared/css/\n"
"│       ├── img -> ../../shared/img/\n"
"│       └── REVISION\n"
"├── repo\n"
"└── shared\n"
"    ├── css/\n"
"    └── img/\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:70
#, no-wrap
msgid "You can find all the Ansistrano documentation on its [Github repository](https://github.com/ansistrano/deploy).\n"
msgstr ""

#. type: Title ##
#: ../src/docs/books/learning_ansible/05-deployments.md:71
#, no-wrap
msgid "Labs"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:74
#, no-wrap
msgid "You will continue to work on your 2 servers:\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:76
#, no-wrap
msgid "The management server:\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:78
#, no-wrap
msgid "Ansible is already installed. You will have to install the `ansistrano.deploy` role.\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:80
#, no-wrap
msgid "The managed server:\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:82
#, no-wrap
msgid "You will need to install Apache and deploy the client site.\n"
msgstr ""

#. type: Title ###
#: ../src/docs/books/learning_ansible/05-deployments.md:83
#, no-wrap
msgid "Deploying the Web server"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:86
#, no-wrap
msgid "For more efficiency, we will use the `geerlingguy.apache` role to configure the server:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:87
#, no-wrap
msgid "$ ansible-galaxy role install geerlingguy.apache\n"
"Starting galaxy role install process\n"
"- downloading role 'apache', owned by geerlingguy\n"
"- downloading role from https://github.com/geerlingguy/ansible-role-apache/archive/3.1.4.tar.gz\n"
"- extracting geerlingguy.apache to /home/ansible/.ansible/roles/geerlingguy.apache\n"
"- geerlingguy.apache (3.1.4) was installed successfully\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:97
#, no-wrap
msgid "We will probably need to open some firewall rules, so we will also install the collection `ansible.posix` to work with its module `firewalld`:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:98
#, no-wrap
msgid "$ ansible-galaxy collection install ansible.posix\n"
"Starting galaxy collection install process\n"
"Process install dependency map\n"
"Starting collection install process\n"
"Downloading https://galaxy.ansible.com/download/ansible-posix-1.2.0.tar.gz to /home/ansible/.ansible/tmp/ansible-local-519039bp65pwn/tmpsvuj1fw5/ansible-posix-1.2.0-bhjbfdpw\n"
"Installing 'ansible.posix:1.2.0' to '/home/ansible/.ansible/collections/ansible_collections/ansible/posix'\n"
"ansible.posix:1.2.0 was installed successfully\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:109
#, no-wrap
msgid "Once the role and the collection are installed, we can create the first part of our playbook, which will:\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:115
#, no-wrap
msgid "Install Apache,\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:115
#, no-wrap
msgid "Create a target folder for our `vhost`,\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:115
#, no-wrap
msgid "Create a default `vhost`,\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:115
#, no-wrap
msgid "Open the firewall,\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:115
#, no-wrap
msgid "Start or restart Apache.\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:117
#, no-wrap
msgid "Technical considerations:\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:122
#, no-wrap
msgid "We will deploy our site to the `/var/www/site/` folder.\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:122
#, no-wrap
msgid "As we will see later, `ansistrano` will create a `current` symbolic link to the current release folder.\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:122
#, no-wrap
msgid "The source code to be deployed contains a `html` folder which the vhost should point to. Its `DirectoryIndex` is `index.htm`.\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:122
#, no-wrap
msgid "The deployment is done by `git`, the package will be installed.\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:126
#, no-wrap
msgid "    The target of our vhost will therefore be: `/var/www/site/current/html`.\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:128
#, no-wrap
msgid "Our playbook to configure the server: `playbook-config-server.yml`\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:129
#, no-wrap
msgid "---\n"
"- hosts: ansible_clients\n"
"  become: yes\n"
"  become_user: root\n"
"  vars:\n"
"    dest: \"/var/www/site/\"\n"
"    apache_global_vhost_settings: |\n"
"      DirectoryIndex index.php index.htm\n"
"    apache_vhosts:\n"
"      - servername: \"website\"\n"
"        documentroot: \"{{ dest }}current/html\"\n\n"
"  tasks:\n\n"
"    - name: create directory for website\n"
"      file:\n"
"        path: /var/www/site/\n"
"        state: directory\n"
"        mode: 0755\n\n"
"    - name: install git\n"
"      package:\n"
"        name: git\n"
"        state: latest\n\n"
"    - name: permit traffic in default zone for http service\n"
"      ansible.posix.firewalld:\n"
"        service: http\n"
"        permanent: yes\n"
"        state: enabled\n"
"        immediate: yes\n\n"
"  roles:\n"
"    - { role: geerlingguy.apache }\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:167
#, no-wrap
msgid "The playbook can be applied to the server:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:168
#, no-wrap
msgid "$ ansible-playbook playbook-config-server.yml\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:173
#, no-wrap
msgid "Note the execution of the following tasks:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:174
#, no-wrap
msgid "TASK [geerlingguy.apache : Ensure Apache is installed on RHEL.] ****************\n"
"TASK [geerlingguy.apache : Configure Apache.] **********************************\n"
"TASK [geerlingguy.apache : Add apache vhosts configuration.] *******************\n"
"TASK [geerlingguy.apache : Ensure Apache has selected state and enabled on boot.] ***\n"
"TASK [permit traffic in default zone for http service] *************************\n"
"RUNNING HANDLER [geerlingguy.apache : restart apache] **************************\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:184
#, no-wrap
msgid "The `geerlingguy.apache` role makes our job much easier by taking care of the installation and configuration of Apache.\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:186
#, no-wrap
msgid "You can check that everything is working by using `curl`:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:187
#, no-wrap
msgid "$ curl -I http://192.168.1.11\n"
"HTTP/1.1 404 Not Found\n"
"Date: Mon, 05 Jul 2021 23:30:02 GMT\n"
"Server: Apache/2.4.37 (rocky) OpenSSL/1.1.1g\n"
"Content-Type: text/html; charset=iso-8859-1\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:198
#, no-wrap
msgid "    We have not yet deployed any code, so it is normal for `curl` to return a `404` HTTP code. But we can already confirm that the `httpd` service is working and that the firewall is open.\n"
msgstr ""

#. type: Title ###
#: ../src/docs/books/learning_ansible/05-deployments.md:199
#, no-wrap
msgid "Deploying the software"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:202
#, no-wrap
msgid "Now that our server is configured, we can deploy the application.\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:204
#, no-wrap
msgid "For this, we will use the `ansistrano.deploy` role in a second playbook dedicated to application deployment (for more readability).\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:205
#, no-wrap
msgid "$ ansible-galaxy role install ansistrano.deploy\n"
"Starting galaxy role install process\n"
"- downloading role 'deploy', owned by ansistrano\n"
"- downloading role from https://github.com/ansistrano/deploy/archive/3.10.0.tar.gz\n"
"- extracting ansistrano.deploy to /home/ansible/.ansible/roles/ansistrano.deploy\n"
"- ansistrano.deploy (3.10.0) was installed successfully\n\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:216
#, no-wrap
msgid "The sources of the software can be found in the [github repository](https://github.com/alemorvan/demo-ansible.git).\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:218
#, no-wrap
msgid "We will create a playbook `playbook-deploy.yml` to manage our deployment:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:219
#, no-wrap
msgid "---\n"
"- hosts: ansible_clients\n"
"  become: yes\n"
"  become_user: root\n"
"  vars:\n"
"    dest: \"/var/www/site/\"\n"
"    ansistrano_deploy_via: \"git\"\n"
"    ansistrano_git_repo: https://github.com/alemorvan/demo-ansible.git\n"
"    ansistrano_deploy_to: \"{{ dest }}\"\n\n"
"  roles:\n"
"     - { role: ansistrano.deploy }\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:234
#, no-wrap
msgid "$ ansible-playbook playbook-deploy.yml\n\n"
"PLAY [ansible_clients] *********************************************************\n\n"
"TASK [ansistrano.deploy : ANSISTRANO | Ensure deployment base path exists] *****\n"
"TASK [ansistrano.deploy : ANSISTRANO | Ensure releases folder exists]\n"
"TASK [ansistrano.deploy : ANSISTRANO | Ensure shared elements folder exists]\n"
"TASK [ansistrano.deploy : ANSISTRANO | Ensure shared paths exists]\n"
"TASK [ansistrano.deploy : ANSISTRANO | Ensure basedir shared files exists]\n"
"TASK [ansistrano.deploy : ANSISTRANO | Get release version] ********************\n"
"TASK [ansistrano.deploy : ANSISTRANO | Get release path]\n"
"TASK [ansistrano.deploy : ANSISTRANO | GIT | Register ansistrano_git_result variable]\n"
"TASK [ansistrano.deploy : ANSISTRANO | GIT | Set git_real_repo_tree]\n"
"TASK [ansistrano.deploy : ANSISTRANO | GIT | Create release folder]\n"
"TASK [ansistrano.deploy : ANSISTRANO | GIT | Sync repo subtree[\"\"] to release path]\n"
"TASK [ansistrano.deploy : ANSISTRANO | Copy git released version into REVISION file]\n"
"TASK [ansistrano.deploy : ANSISTRANO | Ensure shared paths targets are absent]\n"
"TASK [ansistrano.deploy : ANSISTRANO | Create softlinks for shared paths and files]\n"
"TASK [ansistrano.deploy : ANSISTRANO | Ensure .rsync-filter is absent]\n"
"TASK [ansistrano.deploy : ANSISTRANO | Setup .rsync-filter with shared-folders]\n"
"TASK [ansistrano.deploy : ANSISTRANO | Get current folder]\n"
"TASK [ansistrano.deploy : ANSISTRANO | Remove current folder if it's a directory]\n"
"TASK [ansistrano.deploy : ANSISTRANO | Change softlink to new release]\n"
"TASK [ansistrano.deploy : ANSISTRANO | Clean up releases]\n\n"
"PLAY RECAP ********************************************************************************************************************************************************************************************************\n"
"192.168.1.11               : ok=25   changed=8    unreachable=0    failed=0    skipped=14   rescued=0    ignored=0   \n\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:266
#, no-wrap
msgid "So many things done with only 11 lines of code!\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:267
#, no-wrap
msgid "$ curl http://192.168.1.11\n"
"<html>\n"
"<head>\n"
"<title>Demo Ansible</title>\n"
"</head>\n"
"<body>\n"
"<h1>Version Master</h1>\n"
"</body>\n"
"<html>\n"
msgstr ""

#. type: Title ###
#: ../src/docs/books/learning_ansible/05-deployments.md:279
#, no-wrap
msgid "Checking on the server"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:282
#, no-wrap
msgid "You can now connect by ssh to your client machine.\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:284
#, no-wrap
msgid "Make a `tree` on the `/var/www/site/` directory:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:285
#, no-wrap
msgid "$ tree /var/www/site/\n"
"/var/www/site\n"
"├── current -> ./releases/20210722155312Z\n"
"├── releases\n"
"│   └── 20210722155312Z\n"
"│       ├── REVISION\n"
"│       └── html\n"
"│           └── index.htm\n"
"├── repo\n"
"│   └── html\n"
"│       └── index.htm\n"
"└── shared\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:301
#: ../src/docs/books/learning_ansible/05-deployments.md:336
#, no-wrap
msgid "Please note:\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:305
#, no-wrap
msgid "the `current` symlink to the release `./releases/20210722155312Z`\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:305
#, no-wrap
msgid "the presence of a directory `shared`\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:305
#, no-wrap
msgid "the presence of the git repos in `./repo/`\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:307
#, no-wrap
msgid "From the Ansible server, restart the deployment **3** times, then check on the client.\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:308
#, no-wrap
msgid "$ tree /var/www/site/\n"
"var/www/site\n"
"├── current -> ./releases/20210722160048Z\n"
"├── releases\n"
"│   ├── 20210722155312Z\n"
"│   │   ├── REVISION\n"
"│   │   └── html\n"
"│   │       └── index.htm\n"
"│   ├── 20210722160032Z\n"
"│   │   ├── REVISION\n"
"│   │   └── html\n"
"│   │       └── index.htm\n"
"│   ├── 20210722160040Z\n"
"│   │   ├── REVISION\n"
"│   │   └── html\n"
"│   │       └── index.htm\n"
"│   └── 20210722160048Z\n"
"│       ├── REVISION\n"
"│       └── html\n"
"│           └── index.htm\n"
"├── repo\n"
"│   └── html\n"
"│       └── index.htm\n"
"└── shared\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:339
#, no-wrap
msgid "`ansistrano` kept the 4 last releases,\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:339
#, no-wrap
msgid "the `current` link linked now to the lastest release\n"
msgstr ""

#. type: Title ###
#: ../src/docs/books/learning_ansible/05-deployments.md:340
#, no-wrap
msgid "Limit the number of releases"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:343
#, no-wrap
msgid "The `ansistrano_keep_releases` variable is used to specify the number of releases to keep.\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:345
#, no-wrap
msgid "Using the `ansistrano_keep_releases` variable, keep only 3 releases of the project. Check.\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:346
#, no-wrap
msgid "---\n"
"- hosts: ansible_clients\n"
"  become: yes\n"
"  become_user: root\n"
"  vars:\n"
"    dest: \"/var/www/site/\"\n"
"    ansistrano_deploy_via: \"git\"\n"
"    ansistrano_git_repo: https://github.com/alemorvan/demo-ansible.git\n"
"    ansistrano_deploy_to: \"{{ dest }}\"\n"
"    ansistrano_keep_releases: 3\n\n"
"  roles:\n"
"     - { role: ansistrano.deploy }\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:362
#, no-wrap
msgid "---\n"
"$ ansible-playbook -i hosts playbook-deploy.yml\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:368
#: ../src/docs/books/learning_ansible/05-deployments.md:437
#, no-wrap
msgid "On the client machine:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:369
#, no-wrap
msgid "$ tree /var/www/site/\n"
"/var/www/site\n"
"├── current -> ./releases/20210722160318Z\n"
"├── releases\n"
"│   ├── 20210722160040Z\n"
"│   │   ├── REVISION\n"
"│   │   └── html\n"
"│   │       └── index.htm\n"
"│   ├── 20210722160048Z\n"
"│   │   ├── REVISION\n"
"│   │   └── html\n"
"│   │       └── index.htm\n"
"│   └── 20210722160318Z\n"
"│       ├── REVISION\n"
"│       └── html\n"
"│           └── index.htm\n"
"├── repo\n"
"│   └── html\n"
"│       └── index.htm\n"
"└── shared\n"
msgstr ""

#. type: Title ###
#: ../src/docs/books/learning_ansible/05-deployments.md:392
#, no-wrap
msgid "Using shared_paths and shared_files"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:395
#, no-wrap
msgid "---\n"
"- hosts: ansible_clients\n"
"  become: yes\n"
"  become_user: root\n"
"  vars:\n"
"    dest: \"/var/www/site/\"\n"
"    ansistrano_deploy_via: \"git\"\n"
"    ansistrano_git_repo: https://github.com/alemorvan/demo-ansible.git\n"
"    ansistrano_deploy_to: \"{{ dest }}\"\n"
"    ansistrano_keep_releases: 3\n"
"    ansistrano_shared_paths:\n"
"      - \"img\"\n"
"      - \"css\"\n"
"    ansistrano_shared_files:\n"
"      - \"logs\"\n\n"
"  roles:\n"
"     - { role: ansistrano.deploy }\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:417
#, no-wrap
msgid "On the client machine, create the file `logs` in the `shared` directory:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:418
#, no-wrap
msgid "sudo touch /var/www/site/shared/logs\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:423
#, no-wrap
msgid "Then execute the playbook:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:424
#, no-wrap
msgid "TASK [ansistrano.deploy : ANSISTRANO | Ensure shared paths targets are absent] *******************************************************\n"
"ok: [192.168.10.11] => (item=img)\n"
"ok: [192.168.10.11] => (item=css)\n"
"ok: [192.168.10.11] => (item=logs/log)\n\n"
"TASK [ansistrano.deploy : ANSISTRANO | Create softlinks for shared paths and files] **************************************************\n"
"changed: [192.168.10.11] => (item=img)\n"
"changed: [192.168.10.11] => (item=css)\n"
"changed: [192.168.10.11] => (item=logs)\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:438
#, no-wrap
msgid "$  tree -F /var/www/site/\n"
"/var/www/site/\n"
"├── current -> ./releases/20210722160631Z/\n"
"├── releases/\n"
"│   ├── 20210722160048Z/\n"
"│   │   ├── REVISION\n"
"│   │   └── html/\n"
"│   │       └── index.htm\n"
"│   ├── 20210722160318Z/\n"
"│   │   ├── REVISION\n"
"│   │   └── html/\n"
"│   │       └── index.htm\n"
"│   └── 20210722160631Z/\n"
"│       ├── REVISION\n"
"│       ├── css -> ../../shared/css/\n"
"│       ├── html/\n"
"│       │   └── index.htm\n"
"│       ├── img -> ../../shared/img/\n"
"│       └── logs -> ../../shared/logs\n"
"├── repo/\n"
"│   └── html/\n"
"│       └── index.htm\n"
"└── shared/\n"
"    ├── css/\n"
"    ├── img/\n"
"    └── logs\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:468
#, no-wrap
msgid "Please note that the last release contains 3 links:  `css`, `img`, and `logs`\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:472
#, no-wrap
msgid "from `/var/www/site/releases/css` to the `../../shared/css/` directory.\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:472
#, no-wrap
msgid "from `/var/www/site/releases/img` to the `../../shared/img/` directory.\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:472
#, no-wrap
msgid "from `/var/www/site/releases/logs` to the `../../shared/logs` file.\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:474
#, no-wrap
msgid "Therefore, the files contained in these 2 folders and the `logs` file are always accessible via the following paths:\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:478
#, no-wrap
msgid "`/var/www/site/current/css/`,\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:478
#, no-wrap
msgid "`/var/www/site/current/img/`,\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:478
#, no-wrap
msgid "`/var/www/site/current/logs`,\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:480
#, no-wrap
msgid "but above all they will be kept from one release to the next.\n"
msgstr ""

#. type: Title ###
#: ../src/docs/books/learning_ansible/05-deployments.md:481
#, no-wrap
msgid "Use a sub-directory of the repository for deployment"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:484
#, no-wrap
msgid "In our case, the repository contains a `html` folder, which contains the site files.\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:486
#, no-wrap
msgid "To avoid this extra level of directory, use the `ansistrano_git_repo_tree` variable by specifying the path of the sub-directory to use.\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:488
#, no-wrap
msgid "Don't forget to modify the Apache configuration to take into account this change!\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:490
#, no-wrap
msgid "Change the playbook for the server configuration `playbook-config-server.yml`\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:491
#, no-wrap
msgid "---\n"
"- hosts: ansible_clients\n"
"  become: yes\n"
"  become_user: root\n"
"  vars:\n"
"    dest: \"/var/www/site/\"\n"
"    apache_global_vhost_settings: |\n"
"      DirectoryIndex index.php index.htm\n"
"    apache_vhosts:\n"
"      - servername: \"website\"\n"
"        documentroot: \"{{ dest }}current/\" # <1>\n\n"
"  tasks:\n\n"
"    - name: create directory for website\n"
"      file:\n"
"        path: /var/www/site/\n"
"        state: directory\n"
"        mode: 0755\n\n"
"    - name: install git\n"
"      package:\n"
"        name: git\n"
"        state: latest\n\n"
"  roles:\n"
"    - { role: geerlingguy.apache }\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:522
#: ../src/docs/books/learning_ansible/05-deployments.md:548
#, no-wrap
msgid "<1> Modify this line\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:524
#, no-wrap
msgid "Change the playbook for the deployment `playbook-deploy.yml`\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:525
#, no-wrap
msgid "---\n"
"- hosts: ansible_clients\n"
"  become: yes\n"
"  become_user: root\n"
"  vars:\n"
"    dest: \"/var/www/site/\"\n"
"    ansistrano_deploy_via: \"git\"\n"
"    ansistrano_git_repo: https://github.com/alemorvan/demo-ansible.git\n"
"    ansistrano_deploy_to: \"{{ dest }}\"\n"
"    ansistrano_keep_releases: 3\n"
"    ansistrano_shared_paths:\n"
"      - \"img\"\n"
"      - \"css\"\n"
"    ansistrano_shared_files:\n"
"      - \"log\"\n"
"    ansistrano_git_repo_tree: 'html' # <1>\n\n"
"  roles:\n"
"     - { role: ansistrano.deploy }\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:550
#, no-wrap
msgid "Don't forget to run both of the playbooks\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:552
#, no-wrap
msgid "Check on the client machine:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:553
#, no-wrap
msgid "$  tree -F /var/www/site/\n"
"/var/www/site/\n"
"├── current -> ./releases/20210722161542Z/\n"
"├── releases/\n"
"│   ├── 20210722160318Z/\n"
"│   │   ├── REVISION\n"
"│   │   └── html/\n"
"│   │       └── index.htm\n"
"│   ├── 20210722160631Z/\n"
"│   │   ├── REVISION\n"
"│   │   ├── css -> ../../shared/css/\n"
"│   │   ├── html/\n"
"│   │   │   └── index.htm\n"
"│   │   ├── img -> ../../shared/img/\n"
"│   │   └── logs -> ../../shared/logs\n"
"│   └── 20210722161542Z/\n"
"│       ├── REVISION\n"
"│       ├── css -> ../../shared/css/\n"
"│       ├── img -> ../../shared/img/\n"
"│       ├── index.htm\n"
"│       └── logs -> ../../shared/logs\n"
"├── repo/\n"
"│   └── html/\n"
"│       └── index.htm\n"
"└── shared/\n"
"    ├── css/\n"
"    ├── img/\n"
"    └── logs\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:585
#, no-wrap
msgid "<1> Please note the absence of `html`\n"
msgstr ""

#. type: Title ###
#: ../src/docs/books/learning_ansible/05-deployments.md:586
#, no-wrap
msgid "Managing git branch or tags"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:589
#, no-wrap
msgid "The `ansistrano_git_branch` variable is used to specify a `branch` or `tag` to deploy.\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:591
#, no-wrap
msgid "Deploy the `releases/v1.1.0` branch:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:592
#, no-wrap
msgid "---\n"
"- hosts: ansible_clients\n"
"  become: yes\n"
"  become_user: root\n"
"  vars:\n"
"    dest: \"/var/www/site/\"\n"
"    ansistrano_deploy_via: \"git\"\n"
"    ansistrano_git_repo: https://github.com/alemorvan/demo-ansible.git\n"
"    ansistrano_deploy_to: \"{{ dest }}\"\n"
"    ansistrano_keep_releases: 3\n"
"    ansistrano_shared_paths:\n"
"      - \"img\"\n"
"      - \"css\"\n"
"    ansistrano_shared_files:\n"
"      - \"log\"\n"
"    ansistrano_git_repo_tree: 'html'\n"
"    ansistrano_git_branch: 'releases/v1.1.0'\n\n"
"  roles:\n"
"     - { role: ansistrano.deploy }\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:618
#, no-wrap
msgid "    You can have fun, during the deployment, refreshing your browser, to see in 'live' the change.\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:619
#, no-wrap
msgid "$ curl http://192.168.1.11\n"
"<html>\n"
"<head>\n"
"<title>Demo Ansible</title>\n"
"</head>\n"
"<body>\n"
"<h1>Version 1.0.1</h1>\n"
"</body>\n"
"<html>\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:632
#, no-wrap
msgid "Deploy the `v2.0.0` tag:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:633
#, no-wrap
msgid "---\n"
"- hosts: ansible_clients\n"
"  become: yes\n"
"  become_user: root\n"
"  vars:\n"
"    dest: \"/var/www/site/\"\n"
"    ansistrano_deploy_via: \"git\"\n"
"    ansistrano_git_repo: https://github.com/alemorvan/demo-ansible.git\n"
"    ansistrano_deploy_to: \"{{ dest }}\"\n"
"    ansistrano_keep_releases: 3\n"
"    ansistrano_shared_paths:\n"
"      - \"img\"\n"
"      - \"css\"\n"
"    ansistrano_shared_files:\n"
"      - \"log\"\n"
"    ansistrano_git_repo_tree: 'html'\n"
"    ansistrano_git_branch: 'v2.0.0'\n\n"
"  roles:\n"
"     - { role: ansistrano.deploy }\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:656
#, no-wrap
msgid "$ curl http://192.168.1.11\n"
"<html>\n"
"<head>\n"
"<title>Demo Ansible</title>\n"
"</head>\n"
"<body>\n"
"<h1>Version 2.0.0</h1>\n"
"</body>\n"
"<html>\n"
msgstr ""

#. type: Title ###
#: ../src/docs/books/learning_ansible/05-deployments.md:668
#, no-wrap
msgid "Actions between deployment steps"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:671
#, no-wrap
msgid "A deployment with Ansistrano respects the following steps:\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:677
#, no-wrap
msgid "`Setup`\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:677
#, no-wrap
msgid "`Update Code`\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:677
#, no-wrap
msgid "`Symlink Shared`\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:677
#, no-wrap
msgid "`Symlink`\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:677
#, no-wrap
msgid "`Clean Up`\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:679
#, no-wrap
msgid "It is possible to intervene before and after each of these steps.\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:683
#, no-wrap
msgid "A playbook can be included through the variables provided for this purpose:\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:686
#, no-wrap
msgid "`ansistrano_before_<task>_tasks_file`\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:686
#, no-wrap
msgid "or `ansistrano_after_<task>_tasks_file`\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:688
#, no-wrap
msgid "Easy example: send an email (or whatever you want like Slack notification) at the beginning of the deployment:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:690
#, no-wrap
msgid "---\n"
"- hosts: ansible_clients\n"
"  become: yes\n"
"  become_user: root\n"
"  vars:\n"
"    dest: \"/var/www/site/\"\n"
"    ansistrano_deploy_via: \"git\"\n"
"    ansistrano_git_repo: https://github.com/alemorvan/demo-ansible.git\n"
"    ansistrano_deploy_to: \"{{ dest }}\"\n"
"    ansistrano_keep_releases: 3\n"
"    ansistrano_shared_paths:\n"
"      - \"img\"\n"
"      - \"css\"\n"
"    ansistrano_shared_files:\n"
"      - \"logs\"\n"
"    ansistrano_git_repo_tree: 'html'\n"
"    ansistrano_git_branch: 'v2.0.0'\n"
"    ansistrano_before_setup_tasks_file: \"{{ playbook_dir }}/deploy/before-setup-tasks.yml\"\n\n"
"  roles:\n"
"     - { role: ansistrano.deploy }\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:715
#, no-wrap
msgid "Create the file `deploy/before-setup-tasks.yml`:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:716
#, no-wrap
msgid "---\n"
"- name: Send a mail\n"
"  mail:\n"
"    subject: Starting deployment on {{ ansible_hostname }}.\n"
"  delegate_to: localhost\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:724
#, no-wrap
msgid "TASK [ansistrano.deploy : include] *************************************************************************************\n"
"included: /home/ansible/deploy/before-setup-tasks.yml for 192.168.10.11\n\n"
"TASK [ansistrano.deploy : Send a mail] *************************************************************************************\n"
"ok: [192.168.10.11 -> localhost]\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:732
#, no-wrap
msgid "[root] # mailx\n"
"Heirloom Mail version 12.5 7/5/10.  Type ? for help.\n"
"\"/var/spool/mail/root\": 1 message 1 new\n"
">N  1 root@localhost.local  Tue Aug 21 14:41  28/946   \"Starting deployment on localhost.\"\n"
msgstr ""

#. type: Bullet: '* '
#: ../src/docs/books/learning_ansible/05-deployments.md:740
#, no-wrap
msgid "You will probably have to restart some services at the end of the deployment, to flush caches for example. Let's restart Apache at the end of the deployment:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:741
#, no-wrap
msgid "---\n"
"- hosts: ansible_clients\n"
"  become: yes\n"
"  become_user: root\n"
"  vars:\n"
"    dest: \"/var/www/site/\"\n"
"    ansistrano_deploy_via: \"git\"\n"
"    ansistrano_git_repo: https://github.com/alemorvan/demo-ansible.git\n"
"    ansistrano_deploy_to: \"{{ dest }}\"\n"
"    ansistrano_keep_releases: 3\n"
"    ansistrano_shared_paths:\n"
"      - \"img\"\n"
"      - \"css\"\n"
"    ansistrano_shared_files:\n"
"      - \"logs\"\n"
"    ansistrano_git_repo_tree: 'html'\n"
"    ansistrano_git_branch: 'v2.0.0'\n"
"    ansistrano_before_setup_tasks_file: \"{{ playbook_dir }}/deploy/before-setup-tasks.yml\"\n"
"    ansistrano_after_symlink_tasks_file: \"{{ playbook_dir }}/deploy/after-symlink-tasks.yml\"\n\n"
"  roles:\n"
"     - { role: ansistrano.deploy }\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:767
#, no-wrap
msgid "Create the file `deploy/after-symlink-tasks.yml`:\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:768
#, no-wrap
msgid "---\n"
"- name: restart apache\n"
"  systemd:\n"
"    name: httpd\n"
"    state: restarted\n"
msgstr ""

#. type: Fenced code block
#: ../src/docs/books/learning_ansible/05-deployments.md:776
#, no-wrap
msgid "TASK [ansistrano.deploy : include] *************************************************************************************\n"
"included: /home/ansible/deploy/after-symlink-tasks.yml for 192.168.10.11\n\n"
"TASK [ansistrano.deploy : restart apache] **************************************************************************************\n"
"changed: [192.168.10.11]\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:785
#, no-wrap
msgid "As you have seen during this chapter, Ansible can greatly improve the life of the system administrator. Very intelligent roles like Ansistrano are \"must haves\" that quickly become indispensable.\n"
msgstr ""

#. type: Plain text
#: ../src/docs/books/learning_ansible/05-deployments.md:786
#, no-wrap
msgid "Using Ansistrano, ensures that good deployment practices are respected, reduces the time needed to put a system into production, and avoids the risk of potential human errors. The machine works fast, well, and rarely makes mistakes!\n"
msgstr ""

